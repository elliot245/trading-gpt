# Trading-AI 技术方案文档

## 1. 需求描述

### 1.1 项目背景

Trading-AI 是一个创新型交易机器人项目，基于 [bbgo](https://github.com/c9s/bbgo) 交易引擎和 [langchaingo](https://github.com/tmc/langchaingo) 语言模型集成框架构建。该项目旨在通过自然语言接口降低算法交易的门槛，使不具备编程技能的交易者也能创建和管理自动化交易策略。

### 1.2 核心需求

1. **自然语言交易策略**：用户能够使用自然语言描述交易策略，系统将其转换为可执行的交易逻辑。
2. **多LLM支持**：支持多种大语言模型，包括 OpenAI、Google AI、Claude AI 和 Ollama。
3. **风险管理**：支持设置止损和止盈参数，确保交易策略的风险可控。
4. **策略交互**：用户可以与策略进行对话，调整或了解策略的行为。
5. **技术指标支持**：支持多种技术指标，如MACD、RSI、布林带等。
6. **多交易所支持**：通过bbgo引擎支持多个加密货币交易所。
7. **通知系统**：提供交易更新和系统状态的通知功能。

### 1.3 项目目标

1. 创建一个稳健、可靠的交易系统，能够执行用自然语言定义的策略
2. 支持多个交易所和交易对
3. 提供全面的反馈和监控功能
4. 确保系统安全性，配备适当的风险管理功能

### 1.4 项目范围

- 初期聚焦于加密货币交易
- 保持与bbgo现有功能的兼容性
- 优先考虑可靠性和安全性，而非功能扩展

## 2. 需求分析

### 2.1 角色分析

#### 2.1.1 用户角色

1. **策略创建者**
   - **特点**：了解交易市场和策略，但可能缺乏编程技能
   - **需求**：希望使用自然语言创建和部署交易策略
   - **预期行为**：描述交易思路，设置风险参数，监控策略执行情况

2. **系统管理员**
   - **特点**：负责系统配置和维护
   - **需求**：需要监控系统健康状态，管理API密钥和配置
   - **预期行为**：配置系统参数，监控系统日志，处理异常情况

3. **交易分析师**
   - **特点**：专注于交易策略优化
   - **需求**：分析策略执行效果，调整策略参数
   - **预期行为**：查看交易记录，分析策略表现，提出改进建议

#### 2.1.2 系统角色

1. **Trading Agent**
   - **职责**：处理自然语言策略，生成交易动作
   - **交互对象**：用户，LLM，交易所

2. **Keeper Agent**
   - **职责**：维护系统状态，协调系统组件
   - **交互对象**：Trading Agent，环境系统

3. **LLM Manager**
   - **职责**：管理与LLM的通信，提供模型选择
   - **交互对象**：各类LLM提供商API

4. **环境系统**
   - **职责**：与外部系统接口，如交易所、市场数据源
   - **交互对象**：交易所API，市场数据源

5. **通知系统**
   - **职责**：向用户提供系统状态和交易更新
   - **交互对象**：用户，通知渠道

### 2.2 用例分析

#### 2.2.1 核心用例

1. **创建交易策略**
   - **参与者**：策略创建者，Trading Agent，LLM Manager
   - **前置条件**：用户已配置交易所API和LLM访问权限
   - **主要流程**：
     1. 用户用自然语言描述交易策略
     2. Trading Agent使用LLM解释策略
     3. 系统询问用户可能的澄清问题
     4. 系统创建可执行的交易逻辑
     5. 用户确认策略参数
     6. 系统部署策略
   - **后置条件**：交易策略被创建并准备执行
   - **异常流程**：
     1. LLM无法理解策略：系统请求用户重新描述或提供更多细节
     2. 参数无效：系统提示用户调整参数

2. **执行交易策略**
   - **参与者**：Trading Agent，环境系统
   - **前置条件**：交易策略已创建
   - **主要流程**：
     1. 系统监控市场条件
     2. 当满足策略条件时，生成交易动作
     3. 环境系统执行交易动作
     4. 系统记录交易结果
     5. 通知系统向用户发送交易更新
   - **后置条件**：交易执行完成，结果被记录
   - **异常流程**：
     1. 交易失败：系统记录错误，通知用户
     2. 市场条件变化：系统根据策略调整行为

3. **调整交易策略**
   - **参与者**：策略创建者，Trading Agent，LLM Manager
   - **前置条件**：交易策略已在执行中
   - **主要流程**：
     1. 用户通过聊天描述调整需求
     2. Trading Agent使用LLM理解调整内容
     3. 系统预览调整效果
     4. 用户确认调整
     5. 系统更新策略
   - **后置条件**：交易策略被更新
   - **异常流程**：
     1. 调整不兼容：系统解释问题并提供替代方案
     2. LLM无法理解调整：系统请求更清晰的说明

#### 2.2.2 辅助用例

1. **监控系统状态**
   - **参与者**：系统管理员，Keeper Agent
   - **主要流程**：
     1. Keeper Agent收集系统状态信息
     2. 系统生成状态报告
     3. 通知系统向管理员提供报告

2. **分析交易绩效**
   - **参与者**：交易分析师，Trading Agent
   - **主要流程**：
     1. 用户请求特定时间段的交易分析
     2. 系统收集交易数据
     3. Trading Agent使用LLM生成分析报告
     4. 系统呈现分析结果
